<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Music Life</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Estilos generales */
    body {
      font-family: 'Inter', sans-serif;
      background-color: #121212;
      color: white;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      -webkit-text-size-adjust: 100%; /* Previene ajuste automático de texto en iOS */
    }

    /* Estilos para el contenido principal */
    .main-content {
      margin-left: 0;
      padding: 20px;
      padding-bottom: 100px; /* Espacio aumentado para la barra del reproductor */
    }

    /* Estilos para las portadas de álbumes */
    .album-cover {
      width: 100%;
      aspect-ratio: 1/1;
      object-fit: cover;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    }

    /* Estilos para la barra del reproductor */
    .player-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #181818;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-top: 1px solid #282828;
      z-index: 50;
    }

    /* Estilos responsivos para móviles */
    @media (max-width: 640px) {
      .main-content {
        padding: 15px;
        padding-bottom: 120px;
      }
      
      #albumsContainer {
        grid-template-columns: 1fr !important;
        gap: 20px !important;
      }
      
      #albumDetailView .flex {
        flex-direction: column;
      }
      
      #detailAlbumCover {
        width: 200px;
        height: 200px;
        margin: 0 auto;
      }
      
      .song-item {
        padding: 8px !important;
      }
      
      .song-title {
        font-size: 14px !important;
        max-width: 200px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: block;
      }
      
      .song-actions button {
        padding: 4px !important;
      }
      
      .song-actions svg {
        width: 18px;
        height: 18px;
      }
    }
    
    /* Estilos para las canciones en la vista de detalle */
    .song-item {
      display: flex;
      align-items: center;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 4px;
      background-color: rgba(255, 255, 255, 0.05);
      transition: background-color 0.2s;
    }
    
    .song-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .song-info {
      flex: 1;
      min-width: 0; /* Importante para que funcione el truncate */
      margin-right: 8px;
    }
    
    .song-title {
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      display: block;
    }
    
    .song-actions {
      display: flex;
      gap: 4px;
      flex-shrink: 0;
    }
    
    /* Estilos para ocultar la barra de desplazamiento */
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
    
    .scrollbar-hide {
      -ms-overflow-style: none;  /* IE and Edge */
      scrollbar-width: none;  /* Firefox */
    }
    
    /* Animación de marquesina para títulos largos */
    @keyframes marquee {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
    
    .animate-marquee {
      white-space: nowrap;
      animation: marquee 15s linear infinite;
      animation-play-state: paused;
    }
    
    /* Solo animar cuando el texto es más largo que su contenedor */
    .overflow-x-auto:hover .animate-marquee {
      animation-play-state: running;
    }
    
    /* Estilos para el reproductor en móviles */
    @media (max-width: 640px) {
      #playerBar {
        padding: 12px 10px !important;
      }
      
      #playerSongName {
        font-size: 16px !important;
        font-weight: 600 !important;
      }
      
      #playerArtist {
        font-size: 13px !important;
      }
    }
  </style>
</head>
<body>
  <!-- Main Content -->
  <main class="main-content">
    <!-- Título principal visible en móviles y desktop -->
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-4xl font-bold text-white bg-gradient-to-r from-green-500 to-blue-500 bg-clip-text text-transparent">MUSIC LIFE BETA</h1>
    </div>
    
    <!-- Album List View -->
    <div id="albumListView">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-3">
        <h2 class="text-2xl md:text-3xl font-bold">Mis Álbumes</h2>
        <div class="flex flex-wrap gap-2 w-full sm:w-auto">
          <div class="flex items-center bg-zinc-800 rounded-lg p-1 mr-2">
            <button onclick="setAlbumColumns(1)" id="oneColumnBtn" class="px-3 py-1 rounded-lg transition-colors" title="Una columna">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>
            <button onclick="setAlbumColumns(2)" id="twoColumnBtn" class="px-3 py-1 rounded-lg bg-green-600 transition-colors" title="Dos columnas">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h7M4 12h7M4 18h7M13 6h7M13 12h7M13 18h7" />
              </svg>
            </button>
          </div>
          <button onclick="showCreateAlbumOverlay()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition-colors flex items-center gap-2 min-h-[44px]">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Nuevo Álbum
          </button>
          <button onclick="showCreateFullAlbumOverlay()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-500 transition-colors flex items-center gap-2 min-h-[44px]">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            <span class="whitespace-nowrap">Álbum Completo</span>
          </button>
          <button onclick="window.AndroidInterface && window.AndroidInterface.abrirSelector()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-500 transition-colors flex items-center gap-2 min-h-[44px]">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
            </svg>
            <span class="whitespace-nowrap">Cargar mis canciones</span>
          </button>
        </div>
      </div>
      <div id="albumsContainer" class="grid grid-cols-2 gap-6">
        <!-- Álbumes dinámicos -->
      </div>
      
      <!-- Contenedor para canciones cargadas desde Android -->
      <div id="androidSongsContainer" class="mt-8 hidden">
        <h2 class="text-2xl font-bold mb-4">Mis Canciones desde Android</h2>
        <div id="misCanciones" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
      </div>
    </div>

    <!-- Album Detail View -->
    <div id="albumDetailView" class="hidden">
      <div class="flex flex-col md:flex-row gap-6">
        <!-- Album Info -->
        <div class="flex flex-col items-center md:items-start gap-4">
          <img id="detailAlbumCover" src="" alt="Album Cover" class="h-64 w-64 rounded-lg shadow-lg object-cover" />
          <div class="text-center md:text-left">
            <h2 id="detailAlbumTitle" class="text-2xl font-bold"></h2>
            <p id="detailAlbumArtist" class="text-zinc-400"></p>
            <p id="albumYear" class="text-zinc-500 text-sm mt-1"></p>
            <p id="albumGenre" class="text-zinc-500 text-sm"></p>
          </div>
          <div class="flex gap-2 mt-2">
            <button onclick="showEditAlbumOverlay()" class="px-4 py-2 bg-zinc-800 text-white rounded hover:bg-zinc-700 transition-colors">Editar Álbum</button>
            <button onclick="showSongOverlay()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-500 transition-colors">+ Agregar Canción</button>
          </div>
          <div class="flex gap-2 mt-2">
            <button onclick="confirmDeleteAlbum()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors">Eliminar Álbum</button>
            <div class="relative">
              <button id="sortButton" class="px-4 py-2 bg-zinc-800 text-white rounded hover:bg-zinc-700 transition-colors" onclick="toggleSortOptions()">
                Ordenar Canciones
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div id="sortOptions" class="absolute z-10 hidden bg-zinc-800 rounded shadow-lg mt-1 w-48 py-1">
                <button onclick="sortSongs('name', 'asc')" class="block w-full text-left px-4 py-2 hover:bg-zinc-700 transition-colors">Nombre (A-Z)</button>
                <button onclick="sortSongs('name', 'desc')" class="block w-full text-left px-4 py-2 hover:bg-zinc-700 transition-colors">Nombre (Z-A)</button>
                <button onclick="sortSongs('date', 'asc')" class="block w-full text-left px-4 py-2 hover:bg-zinc-700 transition-colors">Fecha (más antigua)</button>
                <button onclick="sortSongs('date', 'desc')" class="block w-full text-left px-4 py-2 hover:bg-zinc-700 transition-colors">Fecha (más reciente)</button>
              </div>
            </div>
          </div>
          <button onclick="showAlbumList()" class="text-zinc-400 hover:text-white mt-4">
            <span class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
              Volver a Álbumes
            </span>
          </button>
        </div>

        <!-- Song List -->
        <div id="detailSongsList" class="flex-1">
          <!-- Canciones se renderizan aquí -->
        </div>
      </div>
    </div>
  </main>

  <!-- Player Bar -->
  <div id="playerBar" class="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-zinc-900 to-zinc-800 border-t border-zinc-700 p-4 flex items-center gap-4 z-40 shadow-lg backdrop-blur-sm bg-opacity-95">
    <img id="playerCover" src="" alt="Cover" class="h-16 w-16 rounded-lg object-cover shadow-md hidden transition-all duration-300 hover:scale-105" />
    <div class="flex-1 min-w-0 ml-2 pr-2">
      <div class="w-full overflow-x-auto whitespace-nowrap scrollbar-hide pb-1">
        <p id="playerSongName" class="text-white font-bold text-xl inline-block animate-marquee"></p>
      </div>
      <p id="playerArtist" class="text-green-400 text-sm truncate"></p>
      <p id="playerLyrics" class="text-zinc-400 text-xs truncate mt-1 italic hidden"></p>
      <!-- Barra de progreso mini -->
      <div class="w-full h-2 bg-zinc-700 rounded-full mt-1 overflow-hidden">
        <div id="miniProgressBar" class="h-full bg-gradient-to-r from-green-500 to-blue-500 rounded-full" style="width: 0%"></div>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <button onclick="playPreviousSong()" class="text-white p-2 rounded-full bg-zinc-800 hover:bg-zinc-700 transition-colors hover:scale-110 active:scale-95">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <button id="playPauseButton" onclick="togglePlayPause()" class="text-white p-3 rounded-full bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 transition-all shadow-md hover:shadow-lg hover:scale-110 active:scale-95">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
        </svg>
      </button>
      <button onclick="playNextSong()" class="text-white p-2 rounded-full bg-zinc-800 hover:bg-zinc-700 transition-colors hover:scale-110 active:scale-95">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
      <button onclick="showFullPlayer()" class="text-white p-2 rounded-full bg-zinc-800 hover:bg-zinc-700 transition-colors ml-2 hover:scale-110 active:scale-95">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Overlay para crear un álbum nuevo -->
  <div id="overlay" class="hidden fixed inset-0 z-50 bg-black bg-opacity-75 flex items-center justify-center">
    <div class="bg-zinc-900 p-8 rounded-2xl w-full max-w-md space-y-4 shadow-2xl">
      <h3 class="text-2xl font-bold text-white">Nuevo Álbum</h3>
      <input id="albumImage" type="file" accept="image/*" class="w-full p-2 rounded bg-zinc-800 text-white" />
      <input id="albumName" type="text" placeholder="Nombre del Álbum" class="w-full p-2 rounded bg-zinc-800 text-white" />
      <input id="albumArtist" type="text" placeholder="Artista" class="w-full p-2 rounded bg-zinc-800 text-white" />
      <div class="flex justify-end gap-2">
        <button onclick="closeOverlay()" class="px-4 py-2 bg-zinc-700 rounded hover:bg-zinc-600">Cancelar</button>
        <button onclick="createAlbum()" class="px-4 py-2 bg-white text-black rounded hover:bg-zinc-200">Crear</button>
      </div>
    </div>
  </div>

  <!-- Overlay para agregar canciones -->
  <div id="songOverlay" class="hidden fixed inset-0 z-50 bg-black bg-opacity-75 flex items-center justify-center">
    <div class="bg-zinc-900 p-8 rounded-2xl w-full max-w-md space-y-4 shadow-2xl">
      <h3 class="text-2xl font-bold text-white">Nueva Canción</h3>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Álbum</label>
        <select id="songAlbumSelect" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors">
          <!-- Las opciones se cargarán dinámicamente -->
        </select>
      </div>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Nombre de la Canción</label>
        <input id="songName" type="text" placeholder="Ej: Bohemian Rhapsody" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
      </div>
      
      <div class="mb-6">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Archivo de Audio</label>
        <input id="songFile" type="file" accept="audio/*" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
        <p class="text-xs text-zinc-500 mt-1">Formatos soportados: MP3, WAV, OGG, etc.</p>
      </div>
      
      <div class="flex justify-end gap-2">
        <button onclick="closeSongOverlay()" class="px-4 py-2 bg-zinc-700 rounded hover:bg-zinc-600 transition-colors">Cancelar</button>
        <button onclick="addSongFromOverlay()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-500 transition-colors">Agregar</button>
      </div>
    </div>
  </div>

  <!-- Overlay para editar un álbum -->
  <div id="editAlbumOverlay" class="hidden fixed inset-0 z-50 bg-black bg-opacity-75 flex items-center justify-center">
    <div class="bg-zinc-900 p-8 rounded-2xl w-full max-w-md space-y-4 shadow-2xl max-h-[90vh] overflow-y-auto">
      <h3 class="text-2xl font-bold text-white">Editar Álbum</h3>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Nombre del Álbum</label>
        <input id="editAlbumName" type="text" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
      </div>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Artista</label>
        <input id="editAlbumArtist" type="text" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
      </div>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Año de Lanzamiento</label>
        <input id="editAlbumYear" type="number" min="1900" max="2099" step="1" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
      </div>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Género</label>
        <select id="editAlbumGenre" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors">
          <option value="">Selecciona un género</option>
          <option value="Pop">Pop</option>
          <option value="Rock">Rock</option>
          <option value="Hip Hop">Hip Hop</option>
          <option value="R&B">R&B</option>
          <option value="Electrónica">Electrónica</option>
          <option value="Jazz">Jazz</option>
          <option value="Clásica">Clásica</option>
          <option value="Reggaeton">Reggaeton</option>
          <option value="Indie">Indie</option>
          <option value="Metal">Metal</option>
          <option value="Folk">Folk</option>
          <option value="Country">Country</option>
          <option value="Blues">Blues</option>
          <option value="Otro">Otro</option>
        </select>
      </div>
      
      <div class="mb-6">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Portada (opcional)</label>
        <input id="editAlbumImage" type="file" accept="image/*" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
        <p class="text-xs text-zinc-500 mt-1">Deja en blanco para mantener la portada actual</p>
      </div>
      
      <div class="flex justify-end gap-2">
        <button onclick="closeEditAlbumOverlay()" class="px-4 py-2 bg-zinc-700 rounded hover:bg-zinc-600 transition-colors">Cancelar</button>
        <button onclick="saveAlbumChanges()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-500 transition-colors">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Overlay para editar una canción -->
  <div id="editSongOverlay" class="hidden fixed inset-0 z-50 bg-black bg-opacity-75 flex items-center justify-center">
    <div class="bg-zinc-900 p-8 rounded-2xl w-full max-w-md space-y-4 shadow-2xl max-h-[90vh] overflow-y-auto">
      <h3 class="text-2xl font-bold text-white">Editar Canción</h3>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Nombre de la Canción</label>
        <input id="editSongName" type="text" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
      </div>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Fecha de Subida</label>
        <input id="editSongDate" type="date" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
      </div>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Género</label>
        <select id="editSongGenre" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors">
          <option value="">Selecciona un género</option>
          <option value="Pop">Pop</option>
          <option value="Rock">Rock</option>
          <option value="Hip Hop">Hip Hop</option>
          <option value="R&B">R&B</option>
          <option value="Electrónica">Electrónica</option>
          <option value="Jazz">Jazz</option>
          <option value="Clásica">Clásica</option>
          <option value="Reggaeton">Reggaeton</option>
          <option value="Indie">Indie</option>
          <option value="Metal">Metal</option>
          <option value="Folk">Folk</option>
          <option value="Country">Country</option>
          <option value="Blues">Blues</option>
          <option value="Otro">Otro</option>
        </select>
      </div>
      
      <div class="mb-6">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Archivo de Audio (opcional)</label>
        <input id="editSongFile" type="file" accept="audio/*" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
        <p class="text-xs text-zinc-500 mt-1">Deja en blanco para mantener el archivo actual</p>
      </div>
      
      <div class="flex justify-end gap-2">
        <button onclick="closeEditSongOverlay()" class="px-4 py-2 bg-zinc-700 rounded hover:bg-zinc-600 transition-colors">Cancelar</button>
        <button onclick="saveSongChanges()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-500 transition-colors">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Overlay para crear un álbum -->
  <div id="createAlbumOverlay" class="hidden fixed inset-0 z-50 bg-black bg-opacity-75 flex items-center justify-center">
    <div class="bg-zinc-900 p-8 rounded-2xl w-full max-w-md space-y-4 shadow-2xl max-h-[90vh] overflow-y-auto">
      <h3 class="text-2xl font-bold text-white">Nuevo Álbum</h3>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Nombre del Álbum</label>
        <input id="newAlbumName" type="text" placeholder="Ej: The Dark Side of the Moon" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
      </div>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Artista</label>
        <input id="newAlbumArtist" type="text" placeholder="Ej: Pink Floyd" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
      </div>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Año de Lanzamiento</label>
        <input id="newAlbumYear" type="number" min="1900" max="2099" step="1" placeholder="Ej: 1973" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
      </div>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Género</label>
        <select id="newAlbumGenre" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors">
          <option value="">Selecciona un género</option>
          <option value="Pop">Pop</option>
          <option value="Rock">Rock</option>
          <option value="Hip Hop">Hip Hop</option>
          <option value="R&B">R&B</option>
          <option value="Electrónica">Electrónica</option>
          <option value="Jazz">Jazz</option>
          <option value="Clásica">Clásica</option>
          <option value="Reggaeton">Reggaeton</option>
          <option value="Indie">Indie</option>
          <option value="Metal">Metal</option>
          <option value="Folk">Folk</option>
          <option value="Country">Country</option>
          <option value="Blues">Blues</option>
          <option value="Otro">Otro</option>
        </select>
      </div>
      
      <div class="mb-6">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Portada</label>
        <input id="newAlbumImage" type="file" accept="image/*" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
        <p class="text-xs text-zinc-500 mt-1">Formatos recomendados: JPG, PNG (tamaño cuadrado)</p>
      </div>
      
      <div class="flex justify-end gap-2">
        <button onclick="closeCreateAlbumOverlay()" class="px-4 py-2 bg-zinc-700 rounded hover:bg-zinc-600 transition-colors">Cancelar</button>
        <button onclick="createNewAlbum()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-500 transition-colors">Crear Álbum</button>
      </div>
    </div>
  </div>

  <!-- Overlay para crear un álbum completo con múltiples canciones -->
  <div id="createFullAlbumOverlay" class="hidden fixed inset-0 z-50 bg-black bg-opacity-75 flex items-center justify-center">
    <div class="bg-zinc-900 p-8 rounded-2xl w-full max-w-4xl space-y-4 shadow-2xl max-h-[90vh] overflow-y-auto">
      <h3 class="text-2xl font-bold text-white">Crear Álbum Completo</h3>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Nombre del Álbum</label>
        <input id="fullAlbumName" type="text" placeholder="Ej: The Dark Side of the Moon" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
      </div>
      
      <div class="mb-4">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Artista</label>
        <input id="fullAlbumArtist" type="text" placeholder="Ej: Pink Floyd" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
      </div>
      
      <div class="flex gap-4 mb-4">
        <div class="flex-1">
          <label class="block text-sm font-medium text-zinc-400 mb-2">Año de Lanzamiento</label>
          <input id="fullAlbumYear" type="number" min="1900" max="2099" step="1" placeholder="Ej: 1973" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
        </div>
        
        <div class="flex-1">
          <label class="block text-sm font-medium text-zinc-400 mb-2">Género</label>
          <select id="fullAlbumGenre" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors">
            <option value="">Selecciona un género</option>
            <option value="Pop">Pop</option>
            <option value="Rock">Rock</option>
            <option value="Hip Hop">Hip Hop</option>
            <option value="R&B">R&B</option>
            <option value="Electrónica">Electrónica</option>
            <option value="Jazz">Jazz</option>
            <option value="Clásica">Clásica</option>
            <option value="Reggaeton">Reggaeton</option>
            <option value="Indie">Indie</option>
            <option value="Metal">Metal</option>
            <option value="Folk">Folk</option>
            <option value="Country">Country</option>
            <option value="Blues">Blues</option>
            <option value="Otro">Otro</option>
          </select>
        </div>
      </div>
      
      <div class="mb-6">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Portada</label>
        <input id="fullAlbumImage" type="file" accept="image/*" class="w-full p-3 rounded bg-zinc-800 text-white border border-zinc-700 focus:border-green-500 outline-none transition-colors" />
        <p class="text-xs text-zinc-500 mt-1">Formatos recomendados: JPG, PNG (tamaño cuadrado)</p>
      </div>
      
      <div class="mb-6">
        <label class="block text-sm font-medium text-zinc-400 mb-2">Seleccionar Canciones (múltiples)</label>
        <input id="fullAlbumSongs" type="file" accept="audio/*" multiple class="hidden" onchange="previewSelectedSongs()" />
        <button type="button" onclick="activateFileInput()" class="w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-500 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <span>Seleccionar Múltiples Archivos</span>
        </button>
        <p class="text-xs text-zinc-500 mt-1">Selecciona múltiples archivos de audio para crear el álbum completo</p>
        <p id="selectedFilesCount" class="text-sm text-green-500 mt-2 hidden"></p>
      </div>
      
      <div id="songsPreviewContainer" class="mb-6 hidden">
        <h4 class="text-lg font-semibold text-white mb-3">Canciones Seleccionadas</h4>
        <p class="text-sm text-zinc-400 mb-3">Asigna un nombre a cada canción:</p>
        <div id="songsPreviewList" class="space-y-3 max-h-60 overflow-y-auto pr-2"></div>
      </div>
      
      <div class="flex justify-end gap-2">
        <button onclick="closeCreateFullAlbumOverlay()" class="px-4 py-2 bg-zinc-700 rounded hover:bg-zinc-600 transition-colors">Cancelar</button>
        <button onclick="createFullAlbum()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-500 transition-colors">Crear Álbum Completo</button>
      </div>
    </div>
  </div>

  <!-- Overlay del reproductor completo -->
  <div id="fullPlayerOverlay" class="hidden fixed inset-0 z-50 bg-black flex flex-col">
    <!-- Botón para cerrar -->
    <div class="p-4">
      <button onclick="closeFullPlayer()" class="text-white">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>
      </button>
    </div>
    
    <!-- Pestañas de navegación -->
    <div class="flex justify-center gap-2 my-2">
      <button id="tabCancion" class="px-4 py-2 rounded-full bg-zinc-800 text-white">REPRODUCTOR LIFE V1</button>
      <button class="text-white ml-auto mr-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
        </svg>
      </button>
    </div>
    
    <!-- Contenido principal -->
    <div class="flex-1 flex flex-col items-center justify-center p-4">
      <!-- Imagen del álbum -->
      <div class="w-full max-w-md aspect-square mb-8">
        <img id="fullPlayerCover" src="" alt="Album cover" class="w-full h-full object-cover rounded-lg shadow-2xl" />
      </div>
      
      <!-- Información de la canción -->
      <div class="w-full max-w-md text-white">
        <h2 id="fullPlayerTitle" class="text-2xl font-bold"></h2>
        <p id="fullPlayerArtist" class="text-lg text-zinc-400"></p>
      </div>
    </div>
    
    <!-- Barra de progreso -->
    <div class="w-full px-8 mb-4">
      <div class="relative w-full h-1 bg-zinc-700 rounded-full cursor-pointer" id="fullPlayerProgressBar">
        <div id="fullPlayerProgress" class="absolute h-full bg-white rounded-full" style="width: 0%;"></div>
      </div>
      <div class="flex justify-between text-zinc-400 text-sm mt-1">
        <span id="fullPlayerCurrentTime">0:00</span>
        <span id="fullPlayerDuration">0:00</span>
      </div>
    </div>
    
    <!-- Control de volumen -->
    <div class="w-full px-8 mb-4 flex items-center gap-3">
      <button onclick="toggleMute()" class="text-white">
        <svg id="volumeIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
        </svg>
      </button>
      <input type="range" id="volumeControl" min="0" max="100" value="100" class="w-full h-1 bg-zinc-700 rounded-full appearance-none cursor-pointer" />
    </div>
    
    <!-- Controles de reproducción -->
    <div class="flex justify-center items-center gap-8 pb-12">
      <button onclick="playPreviousAlbum()" class="text-white">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5l-5 5 5 5M3 10h14" />
        </svg>
      </button>
      <button onclick="playPreviousSong()" class="text-white">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <button id="fullPlayerPlayPause" onclick="togglePlayPause()" class="bg-white rounded-full p-4 text-black">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </button>
      <button onclick="playNextSong()" class="text-white">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
      <button onclick="playNextAlbum()" class="text-white">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 5l5 5-5 5M21 10H7" />
        </svg>
      </button>
    </div>
    
    <!-- Navegación inferior -->
    <div class="flex justify-around pb-8 text-zinc-400">
      <button class="flex flex-col items-center">
        <span>MUSIC LIFE VERSION BETA</span>
      </button>

    </div>
  </div>

  <script>
    // Variables globales
    let albums = JSON.parse(localStorage.getItem('albums')) || [];
    let currentAlbumIndex = -1;
    let currentAudio = null;
    let currentSongIndex = -1;
    let isPlaying = false;
    let selectedAlbumForSong = -1;
    let editingAlbumIndex = -1;
    let editingSongIndex = -1;
    let db; // Base de datos IndexedDB

    // Inicializar IndexedDB para almacenar archivos de audio
    function initIndexedDB() {
      const request = indexedDB.open('MusicLifeDB', 1);
      
      request.onerror = function(event) {
        console.error("Error al abrir IndexedDB:", event.target.error);
        alert("Error al inicializar la base de datos. Es posible que algunas canciones no se guarden correctamente.");
      };
      
      request.onupgradeneeded = function(event) {
        const db = event.target.result;
        // Crear un almacén de objetos para los archivos de audio
        if (!db.objectStoreNames.contains('audioFiles')) {
          db.createObjectStore('audioFiles', { keyPath: 'id' });
        }
      };
      
      request.onsuccess = function(event) {
        db = event.target.result;
        console.log("IndexedDB inicializada correctamente");
        // Cargar los archivos de audio almacenados
        loadStoredAudioFiles();
      };
    }

    // Cargar archivos de audio almacenados en IndexedDB
    function loadStoredAudioFiles() {
      if (!db) return;
      
      const transaction = db.transaction(['audioFiles'], 'readonly');
      const store = transaction.objectStore('audioFiles');
      const request = store.getAll();
      
      request.onsuccess = function(event) {
        const audioFiles = event.target.result;
        console.log(`Cargados ${audioFiles.length} archivos de audio desde IndexedDB`);
        
        // Recorrer todos los álbumes y canciones para actualizar las URLs
        albums.forEach((album, albumIndex) => {
          if (album.songs) {
            album.songs.forEach((song, songIndex) => {
              if (song.audioId) {
                // Buscar el archivo de audio correspondiente
                const audioFile = audioFiles.find(file => file.id === song.audioId);
                if (audioFile) {
                  // Crear una URL para el archivo almacenado
                  const blob = new Blob([audioFile.data], { type: audioFile.type });
                  song.file = URL.createObjectURL(blob);
                  console.log(`URL creada para la canción ${song.name}`);
                }
              }
            });
          }
        });
      };
      
      request.onerror = function(event) {
        console.error("Error al cargar archivos de audio:", event.target.error);
      };
    }

    // Guardar un archivo de audio en IndexedDB
    function saveAudioFile(file, callback) {
      if (!db) {
        console.error("IndexedDB no está inicializada");
        return;
      }
      
      const audioId = 'audio_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      
      // Leer el archivo como ArrayBuffer
      const reader = new FileReader();
      reader.onload = function (e) {
        const transaction = db.transaction(['audioFiles'], 'readwrite');
        const store = transaction.objectStore('audioFiles');
        
        // Guardar el archivo en IndexedDB
        const audioFile = {
          id: audioId,
          name: file.name,
          type: file.type,
          size: file.size,
          data: e.target.result
        };
        
        const request = store.add(audioFile);
        
        request.onsuccess = function() {
          console.log("Archivo de audio guardado en IndexedDB:", audioId);
          // Crear una URL para el archivo
          const blob = new Blob([e.target.result], { type: file.type });
          const fileUrl = URL.createObjectURL(blob);
          
          // Llamar al callback con el ID y la URL
          if (callback) callback(audioId, fileUrl);
        };
        
        request.onerror = function(event) {
          console.error("Error al guardar archivo de audio:", event.target.error);
          alert("Error al guardar el archivo de audio. Inténtalo de nuevo.");
        };
      };
      
      reader.onerror = function(event) {
        console.error("Error al leer el archivo:", event.target.error);
        alert("Error al leer el archivo de audio. Inténtalo de nuevo.");
      };
      
      reader.readAsArrayBuffer(file);
    }

    // Función para mostrar el overlay
    function showOverlay() {
      document.getElementById('overlay').classList.remove('hidden');
    }

    // Función para cerrar el overlay
    function closeOverlay() {
      document.getElementById('overlay').classList.add('hidden');
      document.getElementById('albumName').value = '';
      document.getElementById('albumArtist').value = '';
      document.getElementById('albumImage').value = '';
    }

    // Función para mostrar el overlay de canciones
    function showSongOverlay() {
      const select = document.getElementById('songAlbumSelect');
      select.innerHTML = '';
      albums.forEach((album, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = album.name;
        select.appendChild(option);
      });
      document.getElementById('songOverlay').classList.remove('hidden');
    }

    // Función para cerrar el overlay de canciones
    function closeSongOverlay() {
      document.getElementById('songOverlay').classList.add('hidden');
      document.getElementById('songName').value = '';
      document.getElementById('songFile').value = '';
      selectedAlbumForSong = -1;
    }

    // Función para crear un álbum
    function createAlbum() {
      const name = document.getElementById('albumName').value;
      const artist = document.getElementById('albumArtist').value;
      const fileInput = document.getElementById('albumImage');
      const file = fileInput.files[0];

      if (!name || !artist || !file) {
        alert('Completa todos los campos');
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const album = { name, artist, image: e.target.result, songs: [] };
        albums.push(album);
        localStorage.setItem('albums', JSON.stringify(albums));
        renderAlbums();
        closeOverlay();
      };
      reader.readAsDataURL(file);
    }

    // Función para agregar una canción a un álbum
    function addSongFromOverlay() {
      try {
        console.log("Iniciando addSongFromOverlay");
        
        const albumSelect = document.getElementById('songAlbumSelect');
        const albumIndex = parseInt(albumSelect.value);
        const name = document.getElementById('songName').value;
        const fileInput = document.getElementById('songFile');
        const file = fileInput.files[0];

        console.log("Álbum seleccionado:", albumIndex);
        console.log("Nombre de la canción:", name);
        console.log("Archivo:", file ? file.name : "No hay archivo");

        if (!name || !file) {
          alert('Completa todos los campos');
          return;
        }

        if (isNaN(albumIndex) || albumIndex < 0 || albumIndex >= albums.length) {
          alert('Selecciona un álbum válido');
          return;
        }

        // En lugar de leer el archivo completo, solo guardamos una referencia a él
        // Creamos una URL temporal para el archivo
        saveAudioFile(file, (audioId, fileUrl) => {
          // Guardamos la información de la canción con la URL temporal
          const song = { 
            name, 
            file: fileUrl,
            fileName: file.name,
            fileType: file.type,
            fileSize: file.size,
            audioId
          };
          
          console.log("Agregando canción al álbum:", albums[albumIndex].name);
          if (!albums[albumIndex].songs) {
            albums[albumIndex].songs = [];
          }
          
          albums[albumIndex].songs.push(song);
          localStorage.setItem('albums', JSON.stringify(albums));
          
          console.log("Canción agregada. Total de canciones en el álbum:", albums[albumIndex].songs.length);
          
          // Si estamos en la vista de detalle del álbum al que se agregó la canción
          if (currentAlbumIndex === albumIndex) {
            console.log("Actualizando vista de detalle");
            renderDetailSongs();
          }
          
          closeSongOverlay();
          
          // Mostrar un mensaje de éxito
          alert(`La canción "${name}" se ha agregado al álbum "${albums[albumIndex].name}"`);
        });
      } catch (error) {
        console.error("Error en addSongFromOverlay:", error);
        alert("Error al agregar la canción: " + error.message);
      }
    }

    // Función para reproducir una canción
    function playSong(index) {
      try {
        console.log(`Intentando reproducir canción ${index} del álbum ${currentAlbumIndex}`);
        
        // Detener la canción actual si existe
        if (currentAudio) {
          currentAudio.pause();
          currentAudio = null;
        }
        
        currentSongIndex = index;
        const song = albums[currentAlbumIndex].songs[index];
        
        console.log("Información de la canción:", song);
        
        // Verificar si la canción tiene un archivo asociado
        if (!song.file) {
          console.error("La canción no tiene un archivo asociado");
          
          // Si la canción tiene un ID de audio almacenado, intentar recuperarlo
          if (song.audioId) {
            console.log("Intentando recuperar audio por ID:", song.audioId);
            
            const transaction = db.transaction(['audioFiles'], 'readonly');
            const store = transaction.objectStore('audioFiles');
            const request = store.get(song.audioId);
            
            request.onsuccess = function(event) {
              const audioFile = event.target.result;
              if (audioFile) {
                console.log("Audio recuperado correctamente");
                const blob = new Blob([audioFile.data], { type: audioFile.type });
                song.file = URL.createObjectURL(blob);
                continuePlayingSong(song);
              } else {
                promptForAudioFile(index);
              }
            };
            
            request.onerror = function(event) {
              console.error("Error al recuperar el archivo de audio:", event.target.error);
              promptForAudioFile(index);
            };
          } else {
            promptForAudioFile(index);
          }
          return;
        }
        
        console.log("Reproduciendo canción con URL:", song.file);
        continuePlayingSong(song);
      } catch (error) {
        console.error("Error en playSong:", error);
        alert("Ocurrió un error al reproducir la canción. Por favor, inténtalo de nuevo.");
      }
    }
    
    // Función para reproducir la canción anterior
    function playPreviousSong() {
      console.log("Intentando reproducir canción anterior");
      console.log("Índice actual:", currentSongIndex, "Álbum actual:", currentAlbumIndex);
      
      if (currentAlbumIndex === -1 || currentSongIndex === -1) {
        console.log("No hay canción o álbum actual");
        return;
      }
      
      // Si hay una canción anterior en el álbum actual
      if (currentSongIndex > 0) {
        console.log("Reproduciendo canción anterior en el mismo álbum");
        playSong(currentSongIndex - 1);
      } else {
        // Si estamos en la primera canción, ir al álbum anterior si existe
        if (currentAlbumIndex > 0) {
          const prevAlbumIndex = currentAlbumIndex - 1;
          const prevAlbum = albums[prevAlbumIndex];
          
          console.log("Cambiando al álbum anterior:", prevAlbumIndex);
          
          if (prevAlbum.songs && prevAlbum.songs.length > 0) {
            showAlbumDetail(prevAlbumIndex);
            const lastSongIndex = prevAlbum.songs.length - 1;
            console.log("Reproduciendo última canción del álbum anterior:", lastSongIndex);
            playSong(lastSongIndex);
          } else {
            console.log("El álbum anterior no tiene canciones");
          }
        } else {
          console.log("Ya estamos en el primer álbum");
        }
      }
    }
    
    // Función para reproducir la siguiente canción
    function playNextSong() {
      console.log("Intentando reproducir siguiente canción");
      console.log("Índice actual:", currentSongIndex, "Álbum actual:", currentAlbumIndex);
      
      if (currentAlbumIndex === -1 || currentSongIndex === -1) {
        console.log("No hay canción o álbum actual");
        return;
      }
      
      const currentAlbum = albums[currentAlbumIndex];
      
      // Si hay una siguiente canción en el álbum actual
      if (currentSongIndex < currentAlbum.songs.length - 1) {
        console.log("Reproduciendo siguiente canción en el mismo álbum");
        playSong(currentSongIndex + 1);
      } else {
        // Si estamos en la última canción, ir al siguiente álbum si existe
        if (currentAlbumIndex < albums.length - 1) {
          const nextAlbumIndex = currentAlbumIndex + 1;
          const nextAlbum = albums[nextAlbumIndex];
          
          console.log("Cambiando al siguiente álbum:", nextAlbumIndex);
          
          if (nextAlbum.songs && nextAlbum.songs.length > 0) {
            showAlbumDetail(nextAlbumIndex);
            console.log("Reproduciendo primera canción del siguiente álbum");
            playSong(0);
          } else {
            console.log("El siguiente álbum no tiene canciones");
          }
        } else {
          console.log("Ya estamos en el último álbum");
        }
      }
    }
    
    // Función para alternar reproducción/pausa
    function togglePlayPause() {
      if (!currentAudio) {
        if (albums[currentAlbumIndex].songs.length > 0) {
          playSong(0);
        }
        return;
      }
      
      if (isPlaying) {
        currentAudio.pause();
        isPlaying = false;
      } else {
        currentAudio.play();
        isPlaying = true;
      }
      
      updatePlayPauseButton();
      updateFullPlayerButton();
    }
    
    // Función para actualizar el botón de reproducción/pausa
    function updatePlayPauseButton() {
      const button = document.getElementById('playPauseButton');
      
      if (isPlaying) {
        button.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        `;
      } else {
        button.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
          </svg>
        `;
      }
    }

    // Función para renderizar los álbumes en la vista principal
    function renderAlbums() {
      const container = document.getElementById('albumsContainer');
      container.innerHTML = '';
      
      // Si no hay álbumes, mostrar mensaje y botón para crear uno
      if (albums.length === 0) {
        container.className = 'flex flex-col items-center justify-center p-8 bg-zinc-800 rounded-2xl';
        const emptyState = document.createElement('div');
        emptyState.className = 'text-center';
        emptyState.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto text-zinc-600 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
          </svg>
          <h3 class="text-xl font-semibold mb-2">No tienes álbumes</h3>
          <p class="text-zinc-400 mb-6">Crea tu primer álbum para comenzar a disfrutar de tu música</p>
          <button onclick="showCreateAlbumOverlay()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-500 transition-colors flex items-center gap-2 mx-auto">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Crear Álbum
          </button>
        `;
        container.appendChild(emptyState);
        return;
      }
      
      // Si hay álbumes, mostrarlos en la cuadrícula
      container.className = 'grid grid-cols-2 gap-6';
      albums.forEach((album, index) => {
        const div = document.createElement('div');
        div.className = 'bg-zinc-800 rounded-2xl p-4 flex flex-col gap-4 shadow-lg hover:shadow-xl transition-all';
        div.innerHTML = `
          <img src="${album.image}" alt="Cover" class="album-cover mx-auto" />
          <div class="text-center">
            <h3 class="text-xl font-bold truncate">${album.name}</h3>
            <p class="text-zinc-400 text-sm truncate">${album.artist}</p>
            ${album.year ? `<p class="text-zinc-500 text-xs">${album.year}</p>` : ''}
            ${album.genre ? `<p class="text-zinc-500 text-xs">${album.genre}</p>` : ''}
          </div>
          <button onclick="showAlbumDetail(${index})" class="text-zinc-400 hover:text-white mt-2">Ver Álbum</button>
          <button onclick="showSongOverlay(${index})" class="mt-2 text-green-500 hover:text-green-400">+ Agregar Canción</button>
        `;
        container.appendChild(div);
      });
    }

    // Función para mostrar el detalle de un álbum
    function showAlbumDetail(index) {
      currentAlbumIndex = index;
      const album = albums[index];
      
      // Actualizar la información del álbum
      document.getElementById('detailAlbumCover').src = album.image;
      document.getElementById('detailAlbumTitle').textContent = album.name;
      document.getElementById('detailAlbumArtist').textContent = album.artist;
      document.getElementById('albumYear').textContent = album.year || '';
      document.getElementById('albumGenre').textContent = album.genre || '';
      
      // Renderizar las canciones
      renderDetailSongs();
      
      // Cambiar de vista
      document.getElementById('albumListView').classList.add('hidden');
      document.getElementById('albumDetailView').classList.remove('hidden');
    }

    // Función para renderizar las canciones en la vista de detalle
    function renderDetailSongs() {
      const container = document.getElementById('detailSongsList');
      container.innerHTML = '';
      
      if (!albums[currentAlbumIndex].songs || albums[currentAlbumIndex].songs.length === 0) {
        container.innerHTML = '<p class="text-center text-zinc-400 py-8">No hay canciones en este álbum</p>';
        return;
      }
      
      albums[currentAlbumIndex].songs.forEach((song, index) => {
        const div = document.createElement('div');
        div.className = 'song-item';
        
        // Información de la canción
        const songInfo = `
          <div class="flex items-center flex-1 min-w-0">
            <div class="text-zinc-400 w-8 text-center">${index + 1}</div>
            <div class="song-info">
              <div class="song-title">${song.name}</div>
              <div class="text-zinc-500 text-xs">${song.date ? new Date(song.date).toLocaleDateString() : ''}</div>
            </div>
          </div>
        `;
        
        // Botones de acción
        const actionButtons = `
          <div class="song-actions">
            <button onclick="showEditSongOverlay(${index})" class="text-zinc-400 hover:text-white p-2" title="Editar">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
              </svg>
            </button>
            <button onclick="confirmDeleteSong(${index})" class="text-zinc-400 hover:text-red-500 p-2" title="Eliminar">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
            </button>
            <button onclick="moveSongUp(${index})" class="text-zinc-400 hover:text-white p-2" title="Mover arriba" ${index === 0 ? 'disabled style="opacity: 0.5;"' : ''}>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
              </svg>
            </button>
            <button onclick="moveSongDown(${index})" class="text-zinc-400 hover:text-white p-2" title="Mover abajo" ${index === albums[currentAlbumIndex].songs.length - 1 ? 'disabled style="opacity: 0.5;"' : ''}>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <button onclick="playSong(${index})" class="text-green-500 hover:text-green-400 p-2" title="Reproducir">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
              </svg>
            </button>
          </div>
        `;
        
        div.innerHTML = songInfo + actionButtons;
        container.appendChild(div);
      });
    }

    // Función para volver a la lista de álbumes
    function showAlbumList() {
      document.getElementById('albumListView').classList.remove('hidden');
      document.getElementById('albumDetailView').classList.add('hidden');
    }

    // Función para mostrar el overlay de edición de álbum
    function showEditAlbumOverlay() {
      editingAlbumIndex = currentAlbumIndex;
      const album = albums[editingAlbumIndex];
      document.getElementById('editAlbumName').value = album.name;
      document.getElementById('editAlbumArtist').value = album.artist;
      document.getElementById('editAlbumYear').value = album.year || '';
      document.getElementById('editAlbumGenre').value = album.genre || '';
      document.getElementById('editAlbumOverlay').classList.remove('hidden');
    }

    // Función para cerrar el overlay de edición de álbum
    function closeEditAlbumOverlay() {
      document.getElementById('editAlbumOverlay').classList.add('hidden');
    }

    // Función para guardar los cambios del álbum
    function saveAlbumChanges() {
      const name = document.getElementById('editAlbumName').value;
      const artist = document.getElementById('editAlbumArtist').value;
      const year = document.getElementById('editAlbumYear').value;
      const genre = document.getElementById('editAlbumGenre').value;
      const fileInput = document.getElementById('editAlbumImage');
      const file = fileInput.files[0];

      if (!name || !artist) {
        alert('Completa todos los campos');
        return;
      }

      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          albums[editingAlbumIndex].image = e.target.result;
          albums[editingAlbumIndex].name = name;
          albums[editingAlbumIndex].artist = artist;
          albums[editingAlbumIndex].year = year;
          albums[editingAlbumIndex].genre = genre;
          localStorage.setItem('albums', JSON.stringify(albums));
          document.getElementById('detailAlbumCover').src = albums[editingAlbumIndex].image;
          document.getElementById('detailAlbumTitle').textContent = albums[editingAlbumIndex].name;
          document.getElementById('detailAlbumArtist').textContent = albums[editingAlbumIndex].artist;
          document.getElementById('albumYear').textContent = albums[editingAlbumIndex].year;
          closeEditAlbumOverlay();
        };
        reader.readAsDataURL(file);
      } else {
        albums[editingAlbumIndex].name = name;
        albums[editingAlbumIndex].artist = artist;
        albums[editingAlbumIndex].year = year;
        albums[editingAlbumIndex].genre = genre;
        localStorage.setItem('albums', JSON.stringify(albums));
        document.getElementById('detailAlbumTitle').textContent = albums[editingAlbumIndex].name;
        document.getElementById('detailAlbumArtist').textContent = albums[editingAlbumIndex].artist;
        document.getElementById('albumYear').textContent = albums[editingAlbumIndex].year;
        closeEditAlbumOverlay();
      }
    }

    // Función para mostrar el overlay de edición de canción
    function showEditSongOverlay(index) {
      editingSongIndex = index;
      const song = albums[currentAlbumIndex].songs[editingSongIndex];
      document.getElementById('editSongName').value = song.name;
      document.getElementById('editSongDate').value = song.date || '';
      document.getElementById('editSongGenre').value = song.genre || '';
      document.getElementById('editSongOverlay').classList.remove('hidden');
    }

    // Función para cerrar el overlay de edición de canción
    function closeEditSongOverlay() {
      document.getElementById('editSongOverlay').classList.add('hidden');
    }

    // Función para guardar los cambios de la canción
    function saveSongChanges() {
      const name = document.getElementById('editSongName').value;
      const date = document.getElementById('editSongDate').value;
      const genre = document.getElementById('editSongGenre').value;
      const fileInput = document.getElementById('editSongFile');
      const file = fileInput.files[0];

      if (!name) {
        alert('Completa el nombre de la canción');
        return;
      }

      // Actualizar el nombre de la canción
      albums[currentAlbumIndex].songs[editingSongIndex].name = name;
      albums[currentAlbumIndex].songs[editingSongIndex].date = date;
      albums[currentAlbumIndex].songs[editingSongIndex].genre = genre;
      
      // Si se seleccionó un nuevo archivo de audio, actualizar la URL
      if (file) {
        saveAudioFile(file, (audioId, fileUrl) => {
          albums[currentAlbumIndex].songs[editingSongIndex].file = fileUrl;
          albums[currentAlbumIndex].songs[editingSongIndex].audioId = audioId;
          localStorage.setItem('albums', JSON.stringify(albums));
          renderDetailSongs();
          closeEditSongOverlay();
        });
      } else {
        localStorage.setItem('albums', JSON.stringify(albums));
        renderDetailSongs();
        closeEditSongOverlay();
      }
      
      // Mostrar mensaje de éxito
      alert(`La canción "${name}" ha sido actualizada`);
    }

    // Función para mostrar el reproductor completo
    function showFullPlayer() {
      if (!currentAudio || currentSongIndex === -1) return;
      
      const song = albums[currentAlbumIndex].songs[currentSongIndex];
      const album = albums[currentAlbumIndex];
      
      // Actualizar la información en el reproductor completo
      document.getElementById('fullPlayerCover').src = album.image;
      document.getElementById('fullPlayerTitle').textContent = song.name;
      document.getElementById('fullPlayerArtist').textContent = album.artist;
      
      // Mostrar el overlay
      document.getElementById('fullPlayerOverlay').classList.remove('hidden');
      
      // Actualizar el estado del botón de reproducción
      updateFullPlayerButton();
      
      // Iniciar la actualización de la barra de progreso
      updateFullPlayerProgress();
    }
    
    // Función para cerrar el reproductor completo
    function closeFullPlayer() {
      document.getElementById('fullPlayerOverlay').classList.add('hidden');
    }
    
    // Función para actualizar el botón de reproducción en el reproductor completo
    function updateFullPlayerButton() {
      const button = document.getElementById('fullPlayerPlayPause');
      if (isPlaying) {
        button.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        `;
      } else {
        button.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        `;
      }
    }
    
    // Función para actualizar la barra de progreso en el reproductor completo
    function updateFullPlayerProgress() {
      if (!currentAudio) return;
      
      const progressBar = document.getElementById('fullPlayerProgressBar');
      const progress = document.getElementById('fullPlayerProgress');
      const currentTimeElement = document.getElementById('fullPlayerCurrentTime');
      const durationElement = document.getElementById('fullPlayerDuration');
      
      // Actualizar la barra de progreso
      const progressPercent = (currentAudio.currentTime / currentAudio.duration) * 100;
      progress.style.width = `${progressPercent}%`;
      
      // Actualizar el tiempo actual
      const currentMinutes = Math.floor(currentAudio.currentTime / 60);
      const currentSeconds = Math.floor(currentAudio.currentTime % 60);
      currentTimeElement.textContent = `${currentMinutes}:${currentSeconds.toString().padStart(2, '0')}`;
      
      // Actualizar la duración
      if (currentAudio.duration) {
        const durationMinutes = Math.floor(currentAudio.duration / 60);
        const durationSeconds = Math.floor(currentAudio.duration % 60);
        durationElement.textContent = `${durationMinutes}:${durationSeconds.toString().padStart(2, '0')}`;
      }
      
      // Actualizar cada segundo
      if (document.getElementById('fullPlayerOverlay').classList.contains('hidden')) return;
      requestAnimationFrame(updateFullPlayerProgress);
    }
    
    // Configurar la barra de progreso para permitir buscar en la canción
    document.getElementById('fullPlayerProgressBar').addEventListener('click', function(e) {
      if (!currentAudio) return;
      
      // Calcular la posición relativa del clic
      const rect = this.getBoundingClientRect();
      const clickPosition = (e.clientX - rect.left) / rect.width;
      
      // Establecer el tiempo de reproducción
      currentAudio.currentTime = clickPosition * currentAudio.duration;
      
      // Actualizar la barra de progreso
      updateFullPlayerProgress();
    });
    
    // Modificar la función togglePlayPause para actualizar también el reproductor completo
    function togglePlayPause() {
      if (!currentAudio) {
        if (albums[currentAlbumIndex].songs.length > 0) {
          playSong(0);
        }
        return;
      }
      
      if (isPlaying) {
        currentAudio.pause();
        isPlaying = false;
      } else {
        currentAudio.play();
        isPlaying = true;
      }
      
      updatePlayPauseButton();
      updateFullPlayerButton();
    }

    // Variables para el álbum completo
    let selectedSongFiles = [];
    
    // Función para mostrar el overlay de creación de álbum completo
    function showCreateFullAlbumOverlay() {
      // Ocultar el overlay de creación de álbum normal
      closeCreateAlbumOverlay();
      
      // Limpiar los campos
      document.getElementById('fullAlbumName').value = '';
      document.getElementById('fullAlbumArtist').value = '';
      document.getElementById('fullAlbumYear').value = '';
      document.getElementById('fullAlbumGenre').value = '';
      document.getElementById('fullAlbumImage').value = '';
      document.getElementById('fullAlbumSongs').value = '';
      document.getElementById('songsPreviewList').innerHTML = '';
      document.getElementById('songsPreviewContainer').classList.add('hidden');
      
      // Reiniciar la lista de archivos seleccionados
      selectedSongFiles = [];
      
      // Mostrar el overlay
      document.getElementById('createFullAlbumOverlay').classList.remove('hidden');
    }
    
    // Función para cerrar el overlay de creación de álbum completo
    function closeCreateFullAlbumOverlay() {
      document.getElementById('createFullAlbumOverlay').classList.add('hidden');
    }
    
    // Función para previsualizar las canciones seleccionadas
    function previewSelectedSongs() {
      const fileInput = document.getElementById('fullAlbumSongs');
      const previewContainer = document.getElementById('songsPreviewContainer');
      const previewList = document.getElementById('songsPreviewList');
      
      // Guardar los archivos seleccionados
      selectedSongFiles = Array.from(fileInput.files);
      
      // Si no hay archivos, ocultar el contenedor de previsualización
      if (selectedSongFiles.length === 0) {
        previewContainer.classList.add('hidden');
        return;
      }
      
      // Mostrar el contenedor de previsualización
      previewContainer.classList.remove('hidden');
      
      // Limpiar la lista de previsualización
      previewList.innerHTML = '';
      
      // Crear un elemento para cada canción
      selectedSongFiles.forEach((file, index) => {
        // Extraer el nombre del archivo sin la extensión
        const fileName = file.name.replace(/\.[^/.]+$/, "");
        
        // Crear el elemento de previsualización
        const songPreview = document.createElement('div');
        songPreview.className = 'bg-zinc-800 p-3 rounded flex items-center gap-3';
        songPreview.innerHTML = `
          <div class="text-zinc-400 w-8 text-center">${index + 1}</div>
          <div class="flex-1">
            <input type="text" id="songName_${index}" value="${fileName}" class="w-full p-2 rounded bg-zinc-700 text-white border border-zinc-600 focus:border-green-500 outline-none transition-colors" placeholder="Nombre de la canción" />
          </div>
          <div class="text-xs text-zinc-500">${formatFileSize(file.size)}</div>
        `;
        
        // Añadir a la lista
        previewList.appendChild(songPreview);
      });
      
      // Mostrar el número de archivos seleccionados
      const selectedFilesCount = document.getElementById('selectedFilesCount');
      selectedFilesCount.textContent = `Seleccionaste ${selectedSongFiles.length} archivos`;
      selectedFilesCount.classList.remove('hidden');
    }
    
    // Función para formatear el tamaño del archivo
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // Función para crear un álbum completo con múltiples canciones
    function createFullAlbum() {
      try {
        // Validar campos obligatorios
        const name = document.getElementById('fullAlbumName').value.trim();
        const artist = document.getElementById('fullAlbumArtist').value.trim();
        const year = document.getElementById('fullAlbumYear').value.trim();
        const genre = document.getElementById('fullAlbumGenre').value;
        const imageFile = document.getElementById('fullAlbumImage').files[0];

        console.log("Nombre del álbum:", name);
        console.log("Artista:", artist);
        console.log("Año:", year);
        console.log("Género:", genre);
        console.log("Imagen:", imageFile ? imageFile.name : "No hay imagen");

        if (!name) {
          alert('Por favor, introduce el nombre del álbum');
          return;
        }
        
        if (!artist) {
          alert('Por favor, ingresa el nombre del artista');
          return;
        }
        
        if (selectedSongFiles.length === 0) {
          alert('Por favor, selecciona al menos una canción para el álbum');
          return;
        }

        // Crear un objeto para el nuevo álbum
        const newAlbum = {
          name,
          artist,
          year,
          genre,
          songs: [],
          image: 'https://via.placeholder.com/300x300?text=Sin+Imagen' // Imagen por defecto
        };
        
        // Si se seleccionó una imagen, procesarla
        if (imageFile) {
          const reader = new FileReader();
          reader.onload = function(e) {
            newAlbum.image = e.target.result;
            // Procesar las canciones y guardar el álbum
            processFullAlbumSongs(newAlbum);
          };
          reader.readAsDataURL(imageFile);
        } else {
          // Procesar las canciones sin imagen personalizada
          processFullAlbumSongs(newAlbum);
        }
      } catch (error) {
        console.error("Error en createFullAlbum:", error);
        alert("Error al crear el álbum completo: " + error.message);
      }
    }
    
    // Función para procesar las canciones del álbum completo
    function processFullAlbumSongs(album) {
      // Mostrar un indicador de carga
      const loadingMessage = document.createElement('div');
      loadingMessage.className = 'fixed inset-0 z-[60] bg-black bg-opacity-75 flex items-center justify-center';
      loadingMessage.innerHTML = `
        <div class="bg-zinc-900 p-6 rounded-lg shadow-lg text-center">
          <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500 mx-auto mb-4"></div>
          <p class="text-white text-lg">Procesando canciones...</p>
          <p class="text-zinc-400 text-sm" id="loadingProgress">0/${selectedSongFiles.length}</p>
        </div>
      `;
      document.body.appendChild(loadingMessage);
      
      // Contador para el progreso
      let processedCount = 0;
      
      // Función para actualizar el progreso
      const updateProgress = () => {
        processedCount++;
        document.getElementById('loadingProgress').textContent = `${processedCount}/${selectedSongFiles.length}`;
        
        // Si todas las canciones han sido procesadas, guardar el álbum
        if (processedCount === selectedSongFiles.length) {
          // Guardar el álbum
          saveNewAlbum(album);
          
          // Eliminar el indicador de carga
          document.body.removeChild(loadingMessage);
          
          // Cerrar el overlay
          closeCreateFullAlbumOverlay();
        }
      };
      
      // Procesar cada archivo de canción
      selectedSongFiles.forEach((file, index) => {
        // Obtener el nombre asignado por el usuario
        const songNameInput = document.getElementById(`songName_${index}`);
        const songName = songNameInput ? songNameInput.value.trim() : file.name.replace(/\.[^/.]+$/, "");
        
        // Guardar el archivo de audio en IndexedDB
        saveAudioFile(file, (audioId, fileUrl) => {
          // Crear el objeto de canción
          const song = {
            name: songName,
            file: fileUrl,
            fileName: file.name,
            fileType: file.type,
            fileSize: file.size,
            audioId: audioId,
            date: new Date().toISOString()
          };
          
          // Añadir la canción al álbum
          album.songs.push(song);
          
          // Actualizar el progreso
          updateProgress();
        });
      });
    }
    
    // Función para guardar el nuevo álbum
    function saveNewAlbum(album) {
      // Añadir el álbum al array
      albums.push(album);
      
      // Guardar en localStorage
      localStorage.setItem('albums', JSON.stringify(albums));
      
      // Actualizar la interfaz
      renderAlbums();
      
      // Mostrar mensaje de éxito
      alert('¡Álbum creado con éxito!');
    }
    
    // Función para confirmar la eliminación de un álbum
    function confirmDeleteAlbum() {
      const albumName = albums[currentAlbumIndex].name;
      if (confirm(`¿Estás seguro de que deseas eliminar el álbum "${albumName}"? Esta acción no se puede deshacer.`)) {
        deleteAlbum();
      }
    }
    
    // Función para eliminar un álbum
    function deleteAlbum() {
      // Si hay canciones con archivos de audio, eliminarlos de IndexedDB
      if (albums[currentAlbumIndex].songs && albums[currentAlbumIndex].songs.length > 0) {
        albums[currentAlbumIndex].songs.forEach(song => {
          if (song.audioId) {
            deleteAudioFile(song.audioId);
          }
        });
      }
      
      // Eliminar el álbum del array
      albums.splice(currentAlbumIndex, 1);
      
      // Guardar los cambios en localStorage
      localStorage.setItem('albums', JSON.stringify(albums));
      
      // Volver a la lista de álbumes y renderizarlos
      showAlbumList();
      renderAlbums();
      
      // Mostrar mensaje de éxito
      alert('El álbum ha sido eliminado correctamente');
    }
    
    // Función para eliminar un archivo de audio de IndexedDB
    function deleteAudioFile(audioId) {
      if (!db) return;
      
      const transaction = db.transaction(['audioFiles'], 'readwrite');
      const store = transaction.objectStore('audioFiles');
      store.delete(audioId);
    }

    // Funciones para el overlay de creación de álbumes
    function showCreateAlbumOverlay() {
      document.getElementById('createAlbumOverlay').classList.remove('hidden');
      // Limpiar el formulario
      document.getElementById('newAlbumName').value = '';
      document.getElementById('newAlbumArtist').value = '';
      document.getElementById('newAlbumYear').value = '';
      document.getElementById('newAlbumGenre').value = '';
      document.getElementById('newAlbumImage').value = '';
    }
    
    function closeCreateAlbumOverlay() {
      document.getElementById('createAlbumOverlay').classList.add('hidden');
    }
    
    function createNewAlbum() {
      const name = document.getElementById('newAlbumName').value.trim();
      const artist = document.getElementById('newAlbumArtist').value.trim();
      const year = document.getElementById('newAlbumYear').value;
      const genre = document.getElementById('newAlbumGenre').value;
      const imageFile = document.getElementById('newAlbumImage').files[0];
      
      // Validaciones básicas
      if (!name) {
        alert('Por favor, ingresa el nombre del álbum');
        return;
      }
      
      if (!artist) {
        alert('Por favor, ingresa el nombre del artista');
        return;
      }
      
      // Crear un objeto para el nuevo álbum
      const newAlbum = {
        name,
        artist,
        year,
        genre,
        songs: [],
        image: 'https://via.placeholder.com/300x300?text=Sin+Imagen' // Imagen por defecto
      };
      
      // Si se seleccionó una imagen, procesarla
      if (imageFile) {
        const reader = new FileReader();
        reader.onload = function(e) {
          newAlbum.image = e.target.result;
          // Guardar el álbum y actualizar la interfaz
          saveNewAlbum(newAlbum);
        };
        reader.readAsDataURL(imageFile);
      } else {
        // Guardar el álbum sin imagen personalizada
        saveNewAlbum(newAlbum);
      }
    }
    
    function saveNewAlbum(album) {
      // Añadir el álbum al array
      albums.push(album);
      
      // Guardar en localStorage
      localStorage.setItem('albums', JSON.stringify(albums));
      
      // Cerrar el overlay
      closeCreateAlbumOverlay();
      
      // Actualizar la interfaz
      renderAlbums();
      
      // Mostrar mensaje de éxito
      alert('¡Álbum creado con éxito!');
    }
    
    // Función para confirmar la eliminación de una canción
    function confirmDeleteSong(index) {
      if (confirm(`¿Estás seguro de que deseas eliminar la canción "${albums[currentAlbumIndex].songs[index].name}"?`)) {
        deleteSong(index);
      }
    }
    
    // Función para eliminar una canción
    function deleteSong(index) {
      const song = albums[currentAlbumIndex].songs[index];
      
      // Si la canción tiene un ID de audio, eliminar el archivo de IndexedDB
      if (song.audioId) {
        deleteAudioFile(song.audioId);
      }
      
      // Eliminar la canción del array
      albums[currentAlbumIndex].songs.splice(index, 1);
      
      // Si la canción que se está reproduciendo es la que se eliminó
      if (currentSongIndex === index && currentAlbumIndex === currentAlbumIndex) {
        // Detener la reproducción
        if (currentAudio) {
          currentAudio.pause();
          currentAudio = null;
          isPlaying = false;
          updatePlayPauseButton();
          updateFullPlayerButton();
        }
        currentSongIndex = -1;
      } else if (currentSongIndex > index && currentAlbumIndex === currentAlbumIndex) {
        // Ajustar el índice de la canción actual si se eliminó una canción anterior
        currentSongIndex--;
      }
      
      // Guardar en localStorage
      localStorage.setItem('albums', JSON.stringify(albums));
      
      // Actualizar la interfaz
      renderDetailSongs();
      
      // Mostrar mensaje de éxito
      alert('Canción eliminada con éxito');
    }
    
    // Función para mover una canción hacia arriba en la lista
    function moveSongUp(index) {
      if (index <= 0) return; // No se puede mover más arriba
      
      // Intercambiar con la canción anterior
      const temp = albums[currentAlbumIndex].songs[index];
      albums[currentAlbumIndex].songs[index] = albums[currentAlbumIndex].songs[index - 1];
      albums[currentAlbumIndex].songs[index - 1] = temp;
      
      // Actualizar el índice de la canción actual si es necesario
      if (currentSongIndex === index) {
        currentSongIndex--;
      } else if (currentSongIndex === index - 1) {
        currentSongIndex++;
      }
      
      // Guardar en localStorage
      localStorage.setItem('albums', JSON.stringify(albums));
      
      // Actualizar la interfaz
      renderDetailSongs();
    }
    
    // Función para mover una canción hacia abajo en la lista
    function moveSongDown(index) {
      if (index >= albums[currentAlbumIndex].songs.length - 1) return; // No se puede mover más abajo
      
      // Intercambiar con la canción siguiente
      const temp = albums[currentAlbumIndex].songs[index];
      albums[currentAlbumIndex].songs[index] = albums[currentAlbumIndex].songs[index + 1];
      albums[currentAlbumIndex].songs[index + 1] = temp;
      
      // Actualizar el índice de la canción actual si es necesario
      if (currentSongIndex === index) {
        currentSongIndex++;
      } else if (currentSongIndex === index + 1) {
        currentSongIndex--;
      }
      
      // Guardar en localStorage
      localStorage.setItem('albums', JSON.stringify(albums));
      
      // Actualizar la interfaz
      renderDetailSongs();
    }
    
    // Función para ordenar las canciones de un álbum
    function sortSongs(criteria, direction = 'asc') {
      const songs = albums[currentAlbumIndex].songs;
      
      // Guardar el nombre de la canción actual para restaurar el índice después de ordenar
      const currentSongName = currentSongIndex >= 0 ? songs[currentSongIndex].name : null;
      
      // Ordenar según el criterio
      if (criteria === 'name') {
        songs.sort((a, b) => {
          const nameA = a.name.toLowerCase();
          const nameB = b.name.toLowerCase();
          return direction === 'asc' ? nameA.localeCompare(nameB) : nameB.localeCompare(nameA);
        });
      } else if (criteria === 'date') {
        songs.sort((a, b) => {
          const dateA = a.date ? new Date(a.date).getTime() : 0;
          const dateB = b.date ? new Date(b.date).getTime() : 0;
          return direction === 'asc' ? dateA - dateB : dateB - dateA;
        });
      }
      
      // Restaurar el índice de la canción actual
      if (currentSongName) {
        const newIndex = songs.findIndex(song => song.name === currentSongName);
        if (newIndex !== -1) {
          currentSongIndex = newIndex;
        }
      }
      
      // Guardar en localStorage
      localStorage.setItem('albums', JSON.stringify(albums));
      
      // Actualizar la interfaz
      renderDetailSongs();
      
      // Cerrar el menú de ordenamiento
      document.getElementById('sortOptions').classList.add('hidden');
    }
    
    // Función para mostrar/ocultar las opciones de ordenamiento
    function toggleSortOptions() {
      const sortOptions = document.getElementById('sortOptions');
      sortOptions.classList.toggle('hidden');
    }
    
    // Cerrar el menú de ordenamiento al hacer clic en cualquier parte de la página
    document.addEventListener('click', function(event) {
      const sortOptions = document.getElementById('sortOptions');
      const sortButton = document.getElementById('sortButton');
      
      if (sortOptions && !sortOptions.classList.contains('hidden') && 
          !sortOptions.contains(event.target) && 
          !sortButton.contains(event.target)) {
        sortOptions.classList.add('hidden');
      }
    });
  </script>
  
  <script>
    // Función para continuar reproduciendo una canción después de cargar su archivo
    function continuePlayingSong(song) {
      try {
        console.log("Continuando reproducción de canción:", song.name);
        console.log("URL del archivo:", song.file);
        
        // Detener la canción actual si existe
        if (currentAudio) {
          currentAudio.pause();
          // Liberar recursos del audio anterior
          currentAudio.src = '';
          currentAudio = null;
        }
        
        currentSongIndex = -1;
        const songIndex = albums[currentAlbumIndex].songs.findIndex(s => s.name === song.name);
        if (songIndex !== -1) {
          currentSongIndex = songIndex;
        }
        
        // Verificar que la URL del archivo sea válida
        if (!song.file || typeof song.file !== 'string' || song.file.trim() === '') {
          console.error("URL de archivo inválida:", song.file);
          alert("El archivo de audio no es válido. Por favor, intenta agregar la canción nuevamente.");
          return;
        }
        
        // Crear un nuevo objeto de audio
        currentAudio = new Audio();
        
        // Configurar eventos antes de asignar la fuente
        currentAudio.addEventListener('canplaythrough', function() {
          console.log("Audio listo para reproducción sin interrupciones");
        });
        
        // Configurar evento para cuando termine la canción
        currentAudio.onended = function() {
          console.log("Canción terminada, reproduciendo la siguiente");
          playNextSong();
        };
        
        // Configurar evento para errores
        currentAudio.onerror = function(e) {
          console.error("Error al reproducir el audio:", e);
          console.error("Código de error:", currentAudio.error ? currentAudio.error.code : "desconocido");
          
          // Intentar recrear el blob desde IndexedDB si hay un error
          if (song.audioId) {
            console.log("Intentando recuperar audio nuevamente por ID:", song.audioId);
            
            const transaction = db.transaction(['audioFiles'], 'readonly');
            const store = transaction.objectStore('audioFiles');
            const request = store.get(song.audioId);
            
            request.onsuccess = function(event) {
              const audioFile = event.target.result;
              if (audioFile) {
                console.log("Audio recuperado correctamente, intentando reproducir de nuevo");
                const blob = new Blob([audioFile.data], { type: audioFile.type });
                const newUrl = URL.createObjectURL(blob);
                
                // Actualizar la URL en el objeto de canción
                song.file = newUrl;
                
                // Intentar reproducir de nuevo con la nueva URL
                const newAudio = new Audio(newUrl);
                currentAudio = newAudio;
                
                // Configurar volumen
                const savedVolume = localStorage.getItem('volume') || 100;
                currentAudio.volume = savedVolume / 100;
                
                currentAudio.play()
                  .then(() => {
                    console.log("Reproducción iniciada correctamente en segundo intento");
                    isPlaying = true;
                    updatePlayerInterface(song);
                  })
                  .catch(error => {
                    console.error("Error en segundo intento:", error);
                    alert("No se pudo reproducir la canción. Intenta con otro navegador o verifica que el archivo sea compatible.");
                  });
              } else {
                alert("No se pudo recuperar el archivo de audio. Por favor, intenta agregar la canción nuevamente.");
              }
            };
          } else {
            alert("Error al reproducir la canción. Por favor, inténtalo de nuevo.");
          }
          
          isPlaying = false;
          updatePlayPauseButton();
          updateFullPlayerButton();
        };
        
        // Configurar el volumen según el valor guardado
        const savedVolume = localStorage.getItem('volume') || 100;
        currentAudio.volume = savedVolume / 100;
        
        // Asignar la fuente después de configurar los eventos
        currentAudio.src = song.file;
        
        // Cargar el audio
        currentAudio.load();
        
        // Iniciar la reproducción
        const playPromise = currentAudio.play();
        
        if (playPromise !== undefined) {
          playPromise
            .then(() => {
              console.log("Reproducción iniciada correctamente");
              isPlaying = true;
              updatePlayerInterface(song);
            })
            .catch(error => {
              console.error("Error al iniciar la reproducción:", error);
              
              // Intentar reproducir después de una interacción del usuario
              alert("Para reproducir música, haz clic en 'Aceptar' y luego presiona el botón de reproducción nuevamente.");
              
              // Preparar para reproducción manual
              isPlaying = false;
              updatePlayPauseButton();
              updateFullPlayerButton();
            });
        }
      } catch (error) {
        console.error("Error en continuePlayingSong:", error);
        alert("Ocurrió un error al reproducir la canción.");
      }
    }
    
    // Función auxiliar para actualizar la interfaz del reproductor
    function updatePlayerInterface(song) {
      // Actualizar la interfaz del reproductor
      document.getElementById('playerCover').src = albums[currentAlbumIndex].image;
      document.getElementById('playerCover').classList.remove('hidden');
      document.getElementById('playerSongName').textContent = song.name;
      document.getElementById('playerArtist').textContent = albums[currentAlbumIndex].artist;
      
      // Mostrar la letra de la canción si existe
      const playerLyrics = document.getElementById('playerLyrics');
      if (song.lyrics && song.lyrics.trim() !== '') {
        playerLyrics.textContent = song.lyrics;
        playerLyrics.classList.remove('hidden');
      } else {
        playerLyrics.classList.add('hidden');
      }
      
      // Actualizar los botones
      updatePlayPauseButton();
      updateFullPlayerButton();
      
      // Si el reproductor completo está abierto, actualizar su información
      if (!document.getElementById('fullPlayerOverlay').classList.contains('hidden')) {
        document.getElementById('fullPlayerCover').src = albums[currentAlbumIndex].image;
        document.getElementById('fullPlayerTitle').textContent = song.name;
        document.getElementById('fullPlayerArtist').textContent = albums[currentAlbumIndex].artist;
        updateFullPlayerProgress();
      }
      
      // Configurar actualización de la barra de progreso mini
      if (currentAudio) {
        // Actualizar la barra de progreso mini cada segundo
        setInterval(updateMiniProgressBar, 1000);
      }
    }
    
    // Función para actualizar la barra de progreso mini
    function updateMiniProgressBar() {
      if (!currentAudio) return;
      
      const progressPercent = (currentAudio.currentTime / currentAudio.duration) * 100;
      const miniProgressBar = document.getElementById('miniProgressBar');
      if (miniProgressBar) {
        miniProgressBar.style.width = `${progressPercent}%`;
      }
    }
  </script>
  
  <script>
    // Función para activar el input de archivos
    function activateFileInput() {
      try {
        const fileInput = document.getElementById('fullAlbumSongs');
        
        // Asegurarnos de que el atributo multiple esté presente
        fileInput.setAttribute('multiple', 'multiple');
        
        // En dispositivos iOS, a veces es necesario forzar la actualización del atributo
        if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
          const clone = fileInput.cloneNode(true);
          fileInput.parentNode.replaceChild(clone, fileInput);
          setTimeout(() => {
            clone.click();
          }, 100);
          return;
        }
        
        // Para otros dispositivos, usar el método estándar
        fileInput.click();
        
        console.log("Input de archivos activado");
      } catch (error) {
        console.error("Error al activar el input de archivos:", error);
        alert("Hubo un problema al abrir el selector de archivos. Intenta tocar directamente en el botón.");
      }
    }
  </script>
  
  <script>
    // Función para cambiar el número de columnas en la vista de álbumes
    function setAlbumColumns(cols) {
      try {
        // Convertir a número para asegurar la comparación correcta
        const columns = Number(cols);
        
        const albumsContainer = document.getElementById('albumsContainer');
        const oneColumnBtn = document.getElementById('oneColumnBtn');
        const twoColumnBtn = document.getElementById('twoColumnBtn');
        
        console.log("Cambiando a", columns, "columnas");
        
        // Guardar preferencia en localStorage
        localStorage.setItem('albumColumns', columns);
        
        // Aplicar los cambios según el número de columnas
        if (columns === 1) {
          // Cambiar a una columna
          albumsContainer.setAttribute('class', 'grid grid-cols-1 gap-6');
          oneColumnBtn.setAttribute('class', 'px-3 py-1 rounded-lg bg-green-600 text-white transition-colors');
          twoColumnBtn.setAttribute('class', 'px-3 py-1 rounded-lg transition-colors');
        } else {
          // Cambiar a dos columnas
          albumsContainer.setAttribute('class', 'grid grid-cols-2 gap-6');
          twoColumnBtn.setAttribute('class', 'px-3 py-1 rounded-lg bg-green-600 text-white transition-colors');
          oneColumnBtn.setAttribute('class', 'px-3 py-1 rounded-lg transition-colors');
        }
      } catch (error) {
        console.error("Error al cambiar columnas:", error);
      }
    }
    
    // Función para cargar la preferencia de columnas al iniciar
    function loadColumnPreference() {
      try {
        const savedColumns = localStorage.getItem('albumColumns');
        if (savedColumns) {
          setAlbumColumns(Number(savedColumns));
        }
      } catch (error) {
        console.error("Error al cargar preferencia de columnas:", error);
      }
    }
  </script>
  
  <script>
    // Inicializar la aplicación
    document.addEventListener('DOMContentLoaded', function() {
      initIndexedDB();
      renderAlbums();
      setupVolumeControl(); // Inicializar el control de volumen
      loadColumnPreference(); // Cargar la preferencia de columnas
      console.log("Aplicación inicializada correctamente");
    });
  </script>
  
  <script>
    // Función para mostrar canciones recibidas desde la aplicación Android
    function mostrarCancionesDesdeApp(json) {
      try {
        const canciones = JSON.parse(json);
        const contenedor = document.getElementById('misCanciones');
        const container = document.getElementById('androidSongsContainer');
        
        // Mostrar el contenedor
        container.classList.remove('hidden');
        
        // Limpiar el contenedor
        contenedor.innerHTML = '';
        
        // Si no hay canciones, mostrar mensaje
        if (!canciones || canciones.length === 0) {
          contenedor.innerHTML = '<p class="text-zinc-400 text-center py-4">No se encontraron canciones</p>';
          return;
        }
        
        // Mostrar las canciones
        canciones.forEach(c => {
          const songElement = document.createElement('div');
          songElement.className = 'bg-zinc-800 rounded-lg p-4 flex flex-col gap-2';
          songElement.innerHTML = `
            <p class="text-white font-medium truncate">${c.nombre || 'Canción sin título'}</p>
            <audio controls src="${c.ruta}" class="w-full" preload="none"></audio>
            <button onclick="agregarCancionDesdeAndroid('${c.nombre}', '${c.ruta}')" class="mt-2 text-green-500 hover:text-green-400 text-sm flex items-center justify-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
              </svg>
              Agregar a un álbum
            </button>
          `;
          contenedor.appendChild(songElement);
        });
        
        // Desplazarse al contenedor de canciones
        setTimeout(() => {
          container.scrollIntoView({ behavior: 'smooth' });
        }, 300);
        
      } catch (error) {
        console.error("Error al procesar las canciones:", error);
        alert("Error al procesar las canciones recibidas desde Android");
      }
    }
    
    // Función para agregar una canción desde Android a un álbum
    function agregarCancionDesdeAndroid(nombre, ruta) {
      try {
        // Mostrar selector de álbum
        const select = document.getElementById('songAlbumSelect');
        select.innerHTML = '';
        albums.forEach((album, index) => {
          const option = document.createElement('option');
          option.value = index;
          option.textContent = album.name;
          select.appendChild(option);
        });
        
        // Rellenar el nombre de la canción
        document.getElementById('songName').value = nombre;
        
        // Guardar la ruta para usarla después
        window.androidSongPath = ruta;
        
        // Mostrar el overlay
        document.getElementById('songOverlay').classList.remove('hidden');
        
        // Añadir un mensaje informativo
        const infoMsg = document.createElement('p');
        infoMsg.id = 'androidSongInfo';
        infoMsg.className = 'text-green-500 text-sm mt-2';
        infoMsg.textContent = 'Canción seleccionada desde Android';
        document.getElementById('songOverlay').querySelector('.mb-6').appendChild(infoMsg);
        
      } catch (error) {
        console.error("Error al preparar la canción para añadir:", error);
        alert("Error al preparar la canción para añadir al álbum");
      }
    }
    
    // Modificar la función addSongFromOverlay para manejar canciones de Android
    const originalAddSongFunction = window.addSongFromOverlay;
    window.addSongFromOverlay = function() {
      try {
        // Si tenemos una ruta de Android, usar esa en lugar del archivo
        if (window.androidSongPath) {
          const albumSelect = document.getElementById('songAlbumSelect');
          const albumIndex = parseInt(albumSelect.value);
          const name = document.getElementById('songName').value;
          
          if (!name) {
            alert('Completa el nombre de la canción');
            return;
          }
          
          if (isNaN(albumIndex) || albumIndex < 0 || albumIndex >= albums.length) {
            alert('Selecciona un álbum válido');
            return;
          }
          
          // Crear objeto de canción con la ruta de Android
          const song = { 
            name, 
            file: window.androidSongPath,
            fileName: name,
            fileType: 'audio/mpeg',
            androidSource: true
          };
          
          // Agregar la canción al álbum
          if (!albums[albumIndex].songs) {
            albums[albumIndex].songs = [];
          }
          
          albums[albumIndex].songs.push(song);
          localStorage.setItem('albums', JSON.stringify(albums));
          
          // Si estamos en la vista de detalle del álbum al que se agregó la canción
          if (currentAlbumIndex === albumIndex) {
            renderDetailSongs();
          }
          
          // Limpiar la ruta de Android
          window.androidSongPath = null;
          
          // Cerrar el overlay
          closeSongOverlay();
          
          // Eliminar el mensaje informativo si existe
          const infoMsg = document.getElementById('androidSongInfo');
          if (infoMsg) infoMsg.remove();
          
          // Mostrar un mensaje de éxito
          alert(`La canción "${name}" se ha agregado al álbum "${albums[albumIndex].name}"`);
          
        } else {
          // Si no hay ruta de Android, usar la función original
          originalAddSongFunction();
        }
      } catch (error) {
        console.error("Error en addSongFromOverlay modificado:", error);
        alert("Error al agregar la canción: " + error.message);
        
        // Limpiar la ruta de Android en caso de error
        window.androidSongPath = null;
      }
    };
    
    // Modificar la función closeSongOverlay para limpiar la ruta de Android
    const originalCloseSongFunction = window.closeSongOverlay;
    window.closeSongOverlay = function() {
      // Limpiar la ruta de Android
      window.androidSongPath = null;
      
      // Eliminar el mensaje informativo si existe
      const infoMsg = document.getElementById('androidSongInfo');
      if (infoMsg) infoMsg.remove();
      
      // Llamar a la función original
      originalCloseSongFunction();
    };
  </script>
</body>
</html>